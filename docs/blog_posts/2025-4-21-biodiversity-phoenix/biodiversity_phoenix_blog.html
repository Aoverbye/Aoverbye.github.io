<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Analysis of Biodiversity Intactness Index (BII) for Maricopa County (Phoenix) – Amanda Overbye</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../logo_white_clean.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../logo_white_clean.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog_posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page">
      <h1 class="title">Analysis of Biodiversity Intactness Index (BII) for Maricopa County (Phoenix)</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta column-page">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block column-page" id="quarto-document-content">





<section id="by-amanda-overbye" class="level4">
<h4 class="anchored" data-anchor-id="by-amanda-overbye">By Amanda Overbye</h4>
<p><a href="https://github.com/Aoverbye/phoenix_biodiversity_intactness">Github repsitory</a></p>
<p>This notebook performs an analysis of the Biodiversity Intactness Index (BII) for Maricopa County (Phoenix) by comparing BII values in 2017 and 2020. We use the <code>io-biodiversity</code> dataset provided by Impact Observatory and Vizzuality and clip it to the boundary of Maricopa County.</p>
</section>
<section id="highlights" class="level3">
<h3 class="anchored" data-anchor-id="highlights">Highlights</h3>
<p><strong>Geospatial Data Handling</strong>:</p>
<ul>
<li>Loading and manipulating geospatial data using libraries like geopandas and rioxarray.</li>
<li>Filtering geographic data for specific regions (e.g., Maricopa County, Phoenix) using shapefiles.</li>
<li>Reprojecting coordinate reference systems (CRS) for compatibility.</li>
</ul>
<p><strong>Data Access and Integration</strong>:</p>
<ul>
<li>Accessing remote datasets (Biodiversity Intactness Index) via the Microsoft Planetary Computer using the pystac_client library.</li>
<li>Searching and retrieving specific datasets using spatial queries (bounding boxes) and time ranges.</li>
</ul>
<p><strong>Raster Data Processing</strong>:</p>
<ul>
<li>Working with raster data (e.g., BII values) and applying geospatial analysis, such as clipping and thresholding.</li>
</ul>
<p><strong>Data Visualization</strong>:</p>
<ul>
<li>Creating maps and visualizing spatial data, including the use of color gradients, legends, and basemaps for better interpretation.</li>
</ul>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<ul>
<li><p><code>o-biodiversity Dataset</code></p>
<p>The io-biodiversity dataset, available on Microsoft’s Planetary Computer, contains Biodiversity Intactness Index (BII) values for the years 2017–2020. The BII measures the abundance of species in an area, offering insights into global biodiversity health. This dataset, provided by Impact Observatory and Vizzuality, is available at a 100-meter resolution and can be accessed through the pystac_client library for specific geographic areas and time periods.</p></li>
<li><p><code>Shapefile (tl_2016_04_tract.shp)</code></p>
<p>The 2020 TIGER/Line shapefile for Arizona, provided by the US Census Bureau, contains detailed geographic boundaries for Census subareas (Cousubs) within the state. This dataset is useful for analyzing regional demographic, social, and economic data at a granular geographic level.</p></li>
</ul>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>Microsoft Planetary Computer, <em>STAC Catalog. Biodiversity Intactness</em>. [Dataset]. https://planetarycomputer.microsoft.com/dataset/io-biodiversity. Accessed 7 December, 2024.</p>
<p>United States Census Bureau. 2024. <em>Arizona County TIGER/Line Shapefiles</em>. [Dataset]. United States Census Bureau. https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html. Accessed 7 December, 2024.</p>
</section>
<section id="setup-and-libraries" class="level2">
<h2 class="anchored" data-anchor-id="setup-and-libraries"><strong>1. Setup and Libraries</strong></h2>
<div id="63d4c59f-e467-491e-9dac-e173eda62f9b" class="cell" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> colors</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rioxr</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pystac_client</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> planetary_computer</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> cx</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client  <span class="co"># To access STAC catalogs</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> planetary_computer  <span class="co"># To sign items from the MPC STAC catalog </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image  <span class="co"># To nicely display images</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-subdivision-shapefile" class="level2">
<h2 class="anchored" data-anchor-id="load-subdivision-shapefile">2. Load Subdivision Shapefile</h2>
<p>I will begin by loading the shapefile for subdivisions in Arizona, which provides the census tract boundaries at a finer geographical scale (county subdivisions). This data will be used to filter for Maricopa County later. I am also going to print the head of the file, so that I can see the exact data the file contains.</p>
<div id="6cca4ec8-718a-4e8b-bf46-846df1cbeaae" class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load subdivision shapefile (county subdivisions for Arizona)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>subdivision <span class="op">=</span> gpd.read_file(<span class="st">'data/subdivision/tl_2024_04_cousub.shp'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print first few rows to check the data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(subdivision.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  STATEFP COUNTYFP COUSUBFP  COUSUBNS       GEOID              GEOIDFQ  \
0      04      005    91198  01934931  0400591198  0600000US0400591198   
1      04      005    91838  01934953  0400591838  0600000US0400591838   
2      04      005    91683  01934950  0400591683  0600000US0400591683   
3      04      023    92295  01934961  0402392295  0600000US0402392295   
4      04      023    92550  01934966  0402392550  0600000US0402392550   

             NAME            NAMELSAD LSAD CLASSFP  MTFCC FUNCSTAT  \
0       Flagstaff       Flagstaff CCD   22      Z5  G4040        S   
1  Kaibab Plateau  Kaibab Plateau CCD   22      Z5  G4040        S   
2        Hualapai        Hualapai CCD   22      Z5  G4040        S   
3         Nogales         Nogales CCD   22      Z5  G4040        S   
4       Patagonia       Patagonia CCD   22      Z5  G4040        S   

         ALAND    AWATER     INTPTLAT      INTPTLON  \
0  12231962349  44576380  +35.1066122  -111.3662507   
1   7228864156  29327221  +36.5991097  -112.1368033   
2   2342313339   3772690  +35.9271665  -113.1170408   
3   1762339489   2382710  +31.4956020  -111.0171332   
4   1439560139    685527  +31.5664619  -110.6410279   

                                            geometry  
0  POLYGON ((-112.13370 35.85596, -112.13368 35.8...  
1  POLYGON ((-112.66039 36.53941, -112.66033 36.5...  
2  POLYGON ((-113.35416 36.04097, -113.35416 36.0...  
3  POLYGON ((-111.36692 31.52136, -111.36316 31.5...  
4  POLYGON ((-110.96273 31.68695, -110.96251 31.6...  </code></pre>
</div>
</div>
</section>
<section id="filter-for-maricopa-county-phoenix-area" class="level2">
<h2 class="anchored" data-anchor-id="filter-for-maricopa-county-phoenix-area">3. Filter for Maricopa County (Phoenix Area)</h2>
<p>Here I am going to filter the subdivisions to isolate the ones corresponding to Maricopa County. Since the data contains census tracts for the entire state of Arizona, we can focus only on the Phoenix area.</p>
<div id="089348dc-303d-467a-a3fa-0f4cbff98faf" class="cell" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Maricopa County (Phoenix area)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>maricopa <span class="op">=</span> subdivision[subdivision[<span class="st">'NAME'</span>] <span class="op">==</span> <span class="st">"Phoenix"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="access-stac-catalog-and-biodiversity-data" class="level2">
<h2 class="anchored" data-anchor-id="access-stac-catalog-and-biodiversity-data">4. Access STAC Catalog and Biodiversity Data</h2>
<p>Next, I am going connect to the STAC catalog from the Microsoft Planetary Computer. This catalog contains a dataset on global biodiversity intactness for the years 2017 to 2020. This step is going to go to the active, online dataset to retrieve the data. After that, I am going to view information about the data set so I know where to go next.</p>
<div id="cd8ab6b3-28ac-470d-a5a3-dc15aa4d9832" class="cell" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the STAC catalog for biodiversity data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>catalog <span class="op">=</span> Client.<span class="bu">open</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    modifier<span class="op">=</span>planetary_computer.sign_inplace,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the 'io-biodiversity' collection</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>biodiversity <span class="op">=</span> catalog.get_child(<span class="st">'io-biodiversity'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-exploration" class="level4">
<h4 class="anchored" data-anchor-id="data-exploration">Data Exploration</h4>
<p>I can tell from reading the description of the data that this data set covers biodiversity intactness. It describes the two componantws it uses to calculate biodiversity intactness as abundance and Compositional Similarity. So basically how many indivudals there are and how similar the composition of species in the area is compared to what is expected from information from the past. I can also see the resolution is 100m.</p>
</section>
</section>
<section id="defining-the-temporal-and-geographic" class="level2">
<h2 class="anchored" data-anchor-id="defining-the-temporal-and-geographic">5. Defining the Temporal And Geographic</h2>
<p>This is where I am going to get the biodiversity data for 2020 and 2017. Here I am first giving the coordinates for the area I want (Pheonix) then I am giving it the time frames I want for each data set.</p>
<div id="7061dbc1-325a-44b7-b769-c89e954388d7" class="cell" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pheonix bounding box </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>bbox <span class="op">=</span> {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"type"</span>: <span class="st">"Polygon"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"coordinates"</span>: [</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            [<span class="op">-</span><span class="fl">112.826843</span>, <span class="fl">32.974108</span>],  <span class="co"># Bottom-left corner</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            [<span class="op">-</span><span class="fl">112.826843</span>, <span class="fl">33.863574</span>],  <span class="co"># Top-left corner</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            [<span class="op">-</span><span class="fl">111.184387</span>, <span class="fl">33.863574</span>],  <span class="co"># Top-right corner</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            [<span class="op">-</span><span class="fl">111.184387</span>, <span class="fl">32.974108</span>],  <span class="co"># Bottom-right corner</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            [<span class="op">-</span><span class="fl">112.826843</span>, <span class="fl">32.974108</span>],  <span class="co"># Closing the polygon</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time range for 2020 and 2017</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>time_range_2020 <span class="op">=</span> <span class="st">"2020-01-01/2020-12-31"</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>time_range_2017 <span class="op">=</span> <span class="st">"2017-01-01/2017-12-31"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="catalog-search-and-retrieve-data-for-2020-and-2017" class="level2">
<h2 class="anchored" data-anchor-id="catalog-search-and-retrieve-data-for-2020-and-2017">6. Catalog Search and Retrieve Data for 2020 and 2017</h2>
<p>I am then going to use the pystac_client to search for biodiversity data for the years 2020 and 2017, using the defined bounding box and time range. This will give me access to the first item in the collection for each year.</p>
<div id="0e1e5aca-0202-48f2-bd19-bea95ace07a0" class="cell" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Catalog search for 2020 with time range</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>search_2020 <span class="op">=</span> catalog.search(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">"io-biodiversity"</span>],</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    intersects<span class="op">=</span>bbox,  <span class="co"># Your bounding box</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    datetime<span class="op">=</span>time_range_2020  <span class="co"># Using time range for 2020</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>item_2020 <span class="op">=</span> search_2020.item_collection()[<span class="dv">0</span>]  <span class="co"># First item in the collection</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Catalog search for 2017 with time range</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>search_2017 <span class="op">=</span> catalog.search(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    collections<span class="op">=</span>[<span class="st">"io-biodiversity"</span>],</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    intersects<span class="op">=</span>bbox,  <span class="co"># Your bounding box</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    datetime<span class="op">=</span>time_range_2017  <span class="co"># Using time range for 2017</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>item_2017 <span class="op">=</span> search_2017.item_collection()[<span class="dv">0</span>]  <span class="co"># First item in the collection</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="771f82e7-90fe-42d7-83a7-34eed0ef7b76" class="cell" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>item_2017</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>item_2020</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">


<style>
.pystac-summary {
    cursor: pointer;
    display: list-item;
    list-style: revert;
    margin-bottom: 0 !important;

    .pystac-l {
        padding-left: 0.5em;
        color: rgb(64, 128, 128);
        font-style: italic;
    }
}
.pystac-row {
    overflow-wrap: break-word;
    padding-left: .825em;

    .pystac-k {
        display: inline-block;
        margin: 0px 0.5em 0px 0px;
    }
    .pystac-v {
        color: rgb(186, 33, 33);
    }
}
.pystac-k {
    color: rgb(0, 128, 0);
    font-weight: 700;
}
</style>
<div class="jp-RenderedJSON jp-mod-trusted jp-OutputArea-output">
    <div class="container" style="line-height: normal;">
        <ul style="padding: 0px; margin: 0px; list-style: none; display: block;">
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"Feature"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">stac_version</span>
            <span class="pystac-v">"1.0.0"</span>
        </li>
    
                
            
                
                    <li><details>
        <summary class="pystac-summary"><span class="pystac-k">stac_extensions</span><span class="pystac-l">[] 3 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">"https://stac-extensions.github.io/projection/v1.0.0/schema.json"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">"https://stac-extensions.github.io/raster/v1.1.0/schema.json"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">2</span>
            <span class="pystac-v">"https://stac-extensions.github.io/version/v1.1.0/schema.json"</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">id</span>
            <span class="pystac-v">"bii_2020_34.74464974521749_-115.38597824385106_cog"</span>
        </li>
    
                
            
                
                    
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">geometry</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"Polygon"</span>
        </li>
    
            
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">coordinates</span><span class="pystac-l">[] 1 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">0</span><span class="pystac-l">[] 9 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">0</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">-114.7625474</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">27.565314</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">1</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">-108.2066425</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">27.565314</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">2</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">-108.2066425</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">34.7446497</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">3</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">-115.3859782</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">34.7446497</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">4</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">-115.3859782</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">29.5649638</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">5</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">-115.3581305</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">28.0791503</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">6</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">-115.2036202</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">27.8662496</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">7</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">-114.9988044</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">27.7099428</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">8</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">-114.7625474</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">27.565314</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        </details></li>
    
                
            
                
                    <li><details>
        <summary class="pystac-summary"><span class="pystac-k">bbox</span><span class="pystac-l">[] 4 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">-115.3859782</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">27.565314</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">2</span>
            <span class="pystac-v">-108.2066425</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">3</span>
            <span class="pystac-v">34.7446497</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
                
            
                
                    
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">properties</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">datetime</span>
            <span class="pystac-v">None</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">proj:epsg</span>
            <span class="pystac-v">4326</span>
        </li>
    
            
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">proj:shape</span><span class="pystac-l">[] 2 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">7992</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">7992</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">end_datetime</span>
            <span class="pystac-v">"2020-12-31T23:59:59Z"</span>
        </li>
    
            
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">proj:transform</span><span class="pystac-l">[] 9 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">0.0008983152841195215</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">0.0</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">2</span>
            <span class="pystac-v">-115.38597824385106</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">3</span>
            <span class="pystac-v">0.0</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">4</span>
            <span class="pystac-v">-0.0008983152841195215</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">5</span>
            <span class="pystac-v">34.74464974521749</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">6</span>
            <span class="pystac-v">0.0</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">7</span>
            <span class="pystac-v">0.0</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">8</span>
            <span class="pystac-v">1.0</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">start_datetime</span>
            <span class="pystac-v">"2020-01-01T00:00:00Z"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
                
            
                
                    <li><details>
        <summary class="pystac-summary"><span class="pystac-k">links</span><span class="pystac-l">[] 5 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">0</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"collection"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://planetarycomputer.microsoft.com/api/stac/v1/collections/io-biodiversity"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">1</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"parent"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://planetarycomputer.microsoft.com/api/stac/v1/collections/io-biodiversity"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">2</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"root"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://planetarycomputer.microsoft.com/api/stac/v1"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Microsoft Planetary Computer STAC API"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">3</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"self"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://planetarycomputer.microsoft.com/api/stac/v1/collections/io-biodiversity/items/bii_2020_34.74464974521749_-115.38597824385106_cog"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/geo+json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">4</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"preview"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://planetarycomputer.microsoft.com/api/data/v1/item/map?collection=io-biodiversity&amp;item=bii_2020_34.74464974521749_-115.38597824385106_cog"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"text/html"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Map of item"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
    </details></li>
                
            
                
                    
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">assets</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">data</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://pcdata01euw.blob.core.windows.net/impact/bii-v1/bii_2020/bii_2020_34.74464974521749_-115.38597824385106_cog.tif?st=2024-12-13T04%3A53%3A32Z&amp;se=2024-12-14T05%3A38%3A32Z&amp;sp=rl&amp;sv=2024-05-04&amp;sr=c&amp;skoid=9c8ff44a-6a2c-4dfb-b298-1c9212f64d9a&amp;sktid=72f988bf-86f1-41af-91ab-2d7cd011db47&amp;skt=2024-12-13T18%3A52%3A58Z&amp;ske=2024-12-20T18%3A52%3A58Z&amp;sks=b&amp;skv=2024-05-04&amp;sig=PQQJMAQokd9KXhi01RW79QNlwYKFC8ZpsjBPeqaD/y8%3D"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"image/tiff; application=geotiff; profile=cloud-optimized"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Biodiversity Intactness"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">description</span>
            <span class="pystac-v">"Terrestrial biodiversity intactness at 100m resolution"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">version</span>
            <span class="pystac-v">"v1"</span>
        </li>
    
            
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">raster:bands</span><span class="pystac-l">[] 1 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">0</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">sampling</span>
            <span class="pystac-v">"area"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">data_type</span>
            <span class="pystac-v">"float32"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">spatial_resolution</span>
            <span class="pystac-v">100</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
    </details></li>
            
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">roles</span><span class="pystac-l">[] 1 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">"data"</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        </details></li>
    
            
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">tilejson</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://planetarycomputer.microsoft.com/api/data/v1/item/tilejson.json?collection=io-biodiversity&amp;item=bii_2020_34.74464974521749_-115.38597824385106_cog&amp;assets=data&amp;tile_format=png&amp;colormap_name=io-bii&amp;rescale=0%2C1&amp;expression=0.97%2A%28data_b1%2A%2A3.84%29&amp;format=png"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"TileJSON with default rendering"</span>
        </li>
    
            
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">roles</span><span class="pystac-l">[] 1 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">"tiles"</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        </details></li>
    
            
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">rendered_preview</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://planetarycomputer.microsoft.com/api/data/v1/item/preview.png?collection=io-biodiversity&amp;item=bii_2020_34.74464974521749_-115.38597824385106_cog&amp;assets=data&amp;tile_format=png&amp;colormap_name=io-bii&amp;rescale=0%2C1&amp;expression=0.97%2A%28data_b1%2A%2A3.84%29&amp;format=png"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"image/png"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Rendered preview"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"preview"</span>
        </li>
    
            
        
            
                <li><details>
        <summary class="pystac-summary"><span class="pystac-k">roles</span><span class="pystac-l">[] 1 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">"overview"</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        </details></li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">collection</span>
            <span class="pystac-v">"io-biodiversity"</span>
        </li>
    
                
            
        </ul>
    </div>
</div>
</div>
</div>
<section id="more-data-exploration" class="level4">
<h4 class="anchored" data-anchor-id="more-data-exploration">More data exploration</h4>
<p>I can tell here that the epsg is 4326, it also shows the datetimes are appropriate based on how I defined the date times earlier.</p>
</section>
</section>
<section id="load-data-for-2020-and-2017" class="level2">
<h2 class="anchored" data-anchor-id="load-data-for-2020-and-2017">8. Load Data for 2020 and 2017</h2>
<p>After retrieving the data, I am going to load it using the rioxarray library, which allows me to work with the raster data.</p>
<div id="1d210b3a-1bfa-4e74-90bf-cdbd563a620c" class="cell" data-tags="[]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading in the data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>rast_2020 <span class="op">=</span> rioxr.open_rasterio(item_2020.assets[<span class="st">"data"</span>].href)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>rast_2017 <span class="op">=</span> rioxr.open_rasterio(item_2017.assets[<span class="st">"data"</span>].href)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-subdivision-in-context" class="level2">
<h2 class="anchored" data-anchor-id="the-subdivision-in-context">9. The Subdivision in Context</h2>
<p>Now, I am going to make a map of the subdivisions of Maricopa County. I want to plot the boundary of Phoenix against a basemap so that I can refer to it later and know the regions of Phoenix my BII map will be refering to.</p>
<div id="8aa67d72-ac67-4989-9028-5cb74e01f68c" class="cell" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>)) </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create face color and adjust alpha</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>fc <span class="op">=</span> colors.to_rgba(<span class="st">'mistyrose'</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>fc <span class="op">=</span> fc[:<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> (<span class="fl">0.4</span>,)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the `maricopa` GeoDataFrame</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>maricopa.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>).plot(ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"red"</span>, facecolor<span class="op">=</span>fc)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add basemap</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, zoom<span class="op">=</span><span class="dv">10</span>, source<span class="op">=</span>cx.providers.CartoDB.Voyager)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>legend_patch <span class="op">=</span> mpatches.Patch(color<span class="op">=</span><span class="st">'mistyrose'</span>, label<span class="op">=</span><span class="st">'Maricopa County'</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>[legend_patch], loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Maricopa County (Phoenix) - County Subdivisions"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="biodiversity_phoenix_blog_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This map shows a clear image of the subdivisions overlaying the Phoenix area. Before I go on to the next step, I want to make sure that I know what the CRS is for the maricopa county data set. I am also going to filter the maricopa data for Phoenix, this seems a bit redundant, but because I will be refering to Phoenix for the rest of this notebook, I want to make sure that is actually the area that I am looking at.</p>
<div id="e800909c-9c6b-4416-8ac8-8696b6d53841" class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check CRS of the Maricopa GeoDataFrame</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(maricopa.crs)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject to match the biodiversity dataset CRS</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>maricopa <span class="op">=</span> maricopa.to_crs(<span class="st">"EPSG:4326"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>EPSG:4269</code></pre>
</div>
</div>
<div id="67717e91-6e0e-4cb6-b4f1-088afd35aca6" class="cell" data-tags="[]" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Phoenix subdivision (using the NAME column)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>phoenix <span class="op">=</span> maricopa[maricopa[<span class="st">'NAME'</span>] <span class="op">==</span> <span class="st">"Phoenix"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clip-raster-data-to-the-phoenix-boundary" class="level2">
<h2 class="anchored" data-anchor-id="clip-raster-data-to-the-phoenix-boundary">10. Clip Raster Data to the Phoenix Boundary</h2>
<p>Next, I am going to clip the 2020 and 2017 raster data to the Phoenix boundary, using the GeoDataFrame of the Phoenix subdivisions. This ensures that I only analyze the area of interest (Phoenix area).</p>
<div id="7a68d3c0-a08e-47d3-b42a-1f353f3371b9" class="cell" data-tags="[]" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip the 2020 raster using the Phoenix geometry</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>phoenix_clip_2020 <span class="op">=</span> rast_2020.rio.clip(phoenix.geometry)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip the 2017 raster using the Phoenix geometry</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>phoenix_clip_2017 <span class="op">=</span> rast_2017.rio.clip(phoenix.geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-the-clipped-data-for-2017-and-2020" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-clipped-data-for-2017-and-2020">11. Plot the Clipped Data for 2017 and 2020</h2>
<p>Here, I plot the clipped BII data for both 2020 and 2017 to visually inspect the changes in biodiversity intactness across the two years. These plots help highlight regions of interest.</p>
<div id="33d719f3-1979-4a33-a767-f3e6c36e5e25" class="cell" data-tags="[]" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the clipped raster with the Maricopa County shapefile boundary</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>phoenix_clip_2020.plot(ax<span class="op">=</span>ax)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>phoenix.plot(ax<span class="op">=</span>ax, color<span class="op">=</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.01</span>), edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="biodiversity_phoenix_blog_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2f52d70e-301d-4ee1-83ba-5dc6138314d7" class="cell" data-tags="[]" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the clipped raster with the Maricopa County shapefile boundary</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>phoenix_clip_2017.plot(ax<span class="op">=</span>ax)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>phoenix.plot(ax<span class="op">=</span>ax, color<span class="op">=</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.01</span>), edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="biodiversity_phoenix_blog_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It is hard to see much of a differences betweeen the two years by just looking at the two images, this is why it is beneficial to do further analysis to see a difference.</p>
</section>
<section id="calculate-bii-for-areas-above-threshold-0.75" class="level2">
<h2 class="anchored" data-anchor-id="calculate-bii-for-areas-above-threshold-0.75">12. Calculate BII for Areas Above Threshold (≥ 0.75)</h2>
<p>To get a clearer picture of potential changes in the BII, I am going to focus on areas where the BII value is above 0.75, which is often considered a threshold for “intact” biodiversity. In order to do this, I will use algebra. First I want convert the raster data into boolean arrays where areas with BII greater than or equal to 0.75 are marked as 1 (intact) and areas below that are marked as 0. Then, I am going to calculate the percentage of pixels above this threshold for each year.</p>
<div id="5a8901a8-eaaf-48e9-8765-48ab7e5c0cd7" class="cell" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to boolean arrays for BII &gt;= 0.75</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>bii_2020_high <span class="op">=</span> (phoenix_clip_2020 <span class="op">&gt;=</span> <span class="fl">0.75</span>).astype(<span class="bu">int</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>bii_2017_high <span class="op">=</span> (phoenix_clip_2017 <span class="op">&gt;=</span> <span class="fl">0.75</span>).astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="880d5786-77fa-4266-914f-7230ea016afd" class="cell" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the total number of pixels for each year</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>total_pixels_2020 <span class="op">=</span> bii_2020_high.count().item()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>total_pixels_2017 <span class="op">=</span> bii_2017_high.count().item()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="aa876991-9c5d-4e8e-825a-deb1d6f2a48b" class="cell" data-tags="[]" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find count of pixels above 0.75 BII for each year</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>bii_pixels_2020 <span class="op">=</span> bii_2020_high.values.<span class="bu">sum</span>()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>bii_pixels_2017 <span class="op">=</span> bii_2017_high.values.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8d152b3e-3688-4ade-b505-7cf428b744a8" class="cell" data-tags="[]" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentages</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>bii_pct_2020 <span class="op">=</span> (bii_pixels_2020 <span class="op">/</span> total_pixels_2020) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>bii_pct_2017 <span class="op">=</span> (bii_pixels_2017 <span class="op">/</span> total_pixels_2017) <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="01958d5c-bbe2-4e1e-a61e-b33a000819aa" class="cell" data-tags="[]" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"In 2017, </span><span class="sc">{</span><span class="bu">round</span>(bii_pct_2017, <span class="dv">2</span>)<span class="sc">}</span><span class="ss">% of Phoenix County had a BII of at least 0.75"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"In 2020, </span><span class="sc">{</span><span class="bu">round</span>(bii_pct_2020, <span class="dv">2</span>)<span class="sc">}</span><span class="ss">% of Phoenix had a BII of at least 0.75"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>In 2017, 4.18% of Phoenix County had a BII of at least 0.75
In 2020, 3.81% of Phoenix had a BII of at least 0.75</code></pre>
</div>
</div>
</section>
<section id="calculate-bii-loss-between-2017-and-2020" class="level2">
<h2 class="anchored" data-anchor-id="calculate-bii-loss-between-2017-and-2020">13. Calculate BII Loss Between 2017 and 2020</h2>
<p>To calculate the loss of intact biodiversity, I am going to subtract the 2017 values by the 2020 values. This will create a difference raster, where a value of 1 indicates a loss of intact areas.</p>
<div id="cc2fd796-df01-40a9-a0d0-5bd0ddfb3116" class="cell" data-tags="[]" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the difference in pixels above 0.75 from 2017 to 2020</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>diff_2017_2020 <span class="op">=</span> bii_2017_high <span class="op">-</span> bii_2020_high</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="436b7335-39a9-4cfa-a4c3-ee2fd036cd7f" class="cell" data-tags="[]" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set all that are not 1 to NA (pixels that fell below threshold)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>loss_2017_2020 <span class="op">=</span> diff_2017_2020.where(diff_2017_2020 <span class="op">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualize-bii-loss" class="level2">
<h2 class="anchored" data-anchor-id="visualize-bii-loss">14. Visualize BII Loss</h2>
<p>Finally, I visualize the areas that experienced BII loss between 2017 and 2020.</p>
<div id="fcd47033-46b6-44a3-b8eb-1bd379f0b12c" class="cell" data-tags="[]" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot BII for 2020</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>phoenix_clip_2020.plot(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">'Greens'</span>, cbar_kwargs<span class="op">=</span>{<span class="st">'orientation'</span>: <span class="st">'horizontal'</span>, <span class="st">'label'</span>: <span class="st">'BII for 2020'</span>})</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot BII loss</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>loss_2017_2020.plot(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">'brg'</span>, add_colorbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Maricopa boundary</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>phoenix.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>legend <span class="op">=</span> [mpatches.Patch(facecolor<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Area with BII ≥ 0.75 lost from 2017 to 2020'</span>)]</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>legend, loc<span class="op">=</span>(<span class="fl">0.25</span>, <span class="op">-</span><span class="fl">0.2</span>))</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Set title</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Biodiversity Intactness Index (BII)\ In Phoenix Subdivisions"</span>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Show plot (no saving)</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="biodiversity_phoenix_blog_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This map shows the Biodiversity Intactness Index (BII) for Maricopa County, which includes the Phoenix metropolitan area, in 2020. The BII is represented by a green color gradient, with darker shades indicating higher biodiversity intactness.</p>
<p>The red highlighted areas are locations that experienced significant BII loss between 2017 and 2020 - their BII dropped below 0.75 during this time period, indicating major biodiversity degradation.</p>
</section>
<section id="references-1" class="level2">
<h2 class="anchored" data-anchor-id="references-1">References</h2>
<p>Microsoft Planetary Computer, <em>STAC Catalog. Biodiversity Intactness</em>. [Dataset]. https://planetarycomputer.microsoft.com/dataset/io-biodiversity. Accessed 7 December, 2024.</p>
<p>United States Census Bureau. 2024. <em>Arizona County TIGER/Line Shapefiles</em>. [Dataset]. United States Census Bureau. https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html. Accessed 7 December, 2024.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>